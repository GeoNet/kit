language: go
go:
  - "1.20"

services:
  - docker

install:
  # dependencies for kit are not vendored and should always build with the latest version.
  - docker pull localstack/localstack
  - export PATH=$PATH:$HOME/.local/bin

before_script:
  - curl -sfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh| sh -s -- -b $(go env GOPATH)/bin
  - curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
  - sudo unzip -o awscliv2.zip
  - sudo ./aws/install
  - docker run -d --rm -it -p 4566:4566 -p 4510-4559:4510-4559 localstack/localstack

script:
  - test -z "$(gofmt -s -l `find . -name "*.go" | egrep -v vendor` | tee /dev/stderr)"
  - go vet ./...
  - go test -v ./... --tags localstack
  - golangci-lint run -E gosec # default linters + gosec

notifications:
  email: false
  slack:
    if: branch in (main, staging, production)
    on_success: never
    on_failure: always
    on_pull_requests: false
    secure: BpF9yGFe0oqi1b4HghLPPnsoRVGQ8b78FY4bKMYR1t2qI1AYmjkm1JTCQ+1b8LY68P8WtQIbRtR2YAnCw+pGTHb4HH6/2OroOxs040c5EVm8S/QRis2U1N09U4+am5a5PBgUwflQpn5yy1z3MbQe6tmcroqcDA8TvD0HoBHbFGRGo4xbsR5h5j+lLxCEI7sovXsJB0mCwLzRGcdXID5PkCJ7z5RkOR9MDEhiaxl4jBBBQRwpByR3DwgORMNuItQ3CsjKXvCzPotEBVroV4CbiygtY9lSWgt+wuLe3gIBo+TVTZnKgzcEyykvQEFGKQh7QQMMztozdW0n7uUf70lkGStxpMaTdpPD5hhGy9WiUcgL10eDgR2xI8whlm5D69TqGz7DRy83YM91jE9eEQYfzMhXgD23mRz6Xy8pVBbbZUByqPdxl4/ZpFZsDEB31o8tHwPiitJhiwxAHFGuKNj2Yw1KUC5hJ2jf8EwFuBRa93EKVm+X/6nl5ObXdsYrafYCVxULPuJZ4bgSNP35hyu2KQWzTMcjODlOE3p7bbRsEkbTxsdts2rQjzE42jul6TcfVFYJ/lQf2Y/9ACJrBG8oRUiszgmO3uvlVK2Bdo8rqa+BJaFNltNzgL/fJlCEehC4AE2KDPlWm3M0WvCFurECw+mKNOINLMOs3R5MQ0c/WZg=
